<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/Style.css">
    <style>
        /* Стили для индикатора загрузки */
        .download-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            display: none;
        }
        
        .download-box {
            background-color: var(--primary-color);
            padding: 30px;
            border-radius: 10px;
            width: 300px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            border: 1px solid var(--accent-color);
        }
        
        .progress-container {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 10px;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .download-text {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <header class="header" id="header">
        <div class="header-container">
            <div class="logo">
                <img src="img/ЯЧ.png" alt="Логотип">
            </div>
            <div class="control-buttons">
                <a href="index.html"><button class="control-btn">Главная</button></a>
                <button class="control-btn" id="downloadBtn">Скачать</button>
                <a href="info.html"><button class="control-btn">О нас</button></a>
            </div>
        </div>
    </header>
    <main class="main-content">
        ПУСТО
    </main>

    <script>
    async function createAndDownloadZip() {
    const overlay = document.getElementById('downloadOverlay');
    const progressBar = document.getElementById('progressBar');
    const downloadText = document.querySelector('.download-text');
    
    overlay.style.display = 'flex';
    downloadText.textContent = 'Подготовка архива...';
    progressBar.style.width = '0%';
    
    try {
        const zip = new JSZip();
        const filePaths = [
            "Download/disk2.pak",
            "Download/disk3.pak",
            "Download/disk4.pak",
            "Download/disk5.pak",
            "Download/disk6.pak",
            "Download/disk7.pak",
            "Download/disk8.pak",
            "Download/disk9.pak",
            "Download/disk10.pak",
            "Download/disk11.pak",
            "Download/disk12.pak",
            "Download/disk13.pak",
            "Download/disk14.pak",
            "Download/disk15.pak",
            "Download/disk16.pak",
            "Download/disk17.pak",
            "Download/disk18.pak",
            "Download/disk19.pak",
            "Download/disk20.pak",
            "Download/disk21.pak",
            "Download/disk22.pak",
            "Download/disk23.pak",
            "Download/SetupScripts.exe"
        ];

        // Разбиваем файлы на группы по 5 штук
        const chunkSize = 5;
        const fileGroups = [];
        for (let i = 0; i < filePaths.length; i += chunkSize) {
            fileGroups.push(filePaths.slice(i, i + chunkSize));
        }

        // Загружаем группы по очереди
        downloadText.textContent = 'Загрузка файлов...';
        let loadedFiles = 0;

        for (const group of fileGroups) {
            const groupPromises = group.map(filePath => 
                fetch(filePath)
                    .then(response => {
                        if (!response.ok) throw new Error(`Ошибка ${response.status}: ${filePath}`);
                        return response.blob().then(blob => ({ path: filePath, blob }));
                    })
                    .catch(error => {
                        console.error(`Ошибка загрузки ${filePath}:`, error);
                        return null; // Пропускаем файл
                    })
            );

            const results = await Promise.all(groupPromises);
            
            // Добавляем успешно загруженные файлы в ZIP
            for (const result of results) {
                if (result) {
                    zip.file(result.path, result.blob);
                    loadedFiles++;
                    progressBar.style.width = `${(loadedFiles / filePaths.length) * 100}%`;
                }
            }
        }

        // Генерируем ZIP
        downloadText.textContent = 'Создание архива...';
        const content = await zip.generateAsync(
            { type: "blob", streamFiles: true },
            metadata => {
                progressBar.style.width = `${Math.round(metadata.percent)}%`;
            }
        );

        // Скачиваем
        saveAs(content, "archive.zip");

    } catch (error) {
        console.error('Ошибка при создании архива:', error);
        alert('Произошла ошибка: ' + error.message);
    } finally {
        setTimeout(() => {
            overlay.style.display = 'none';
            progressBar.style.width = '0%';
            downloadText.textContent = 'Подготовка архива...';
        }, 1000);
    }
}
</script>
</body>
</html>
